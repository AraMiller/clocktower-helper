# 测试说明文档

## 测试框架

本项目使用 **Jest** 作为测试框架，配合 **ts-jest** 来处理 TypeScript 文件。

## 已安装的测试依赖

- `jest` - Jest 测试框架
- `ts-jest` - TypeScript 支持
- `@types/jest` - Jest 类型定义
- `@testing-library/react` - React 组件测试工具
- `@testing-library/jest-dom` - DOM 测试工具

## 测试文件结构

```
├── app/
│   ├── gameLogic.ts      # 核心游戏逻辑函数（可测试）
│   └── ...
├── gameLoop.test.js      # 游戏循环测试文件
└── jest.config.js         # Jest 配置文件
```

## 运行测试

### 1. 运行所有测试

```bash
npm test
```

### 2. 监听模式（自动重新运行测试）

```bash
npm run test:watch
```

### 3. 生成测试覆盖率报告

```bash
npm run test:coverage
```

## 测试内容

### 基本流程测试

✅ **游戏能正常开始，所有玩家分配到了角色**

- 初始化5个玩家的座位
- 为所有玩家分配角色
- 为15个玩家分配角色
- 角色数量不匹配时抛出错误
- 无效角色ID时抛出错误
- 酒鬼角色自动标记为醉酒

### 规则冲突测试

✅ **如果一个玩家被"杀死"了，验证他的状态确实变成了"死亡"，且无法再发动技能**

- 能够杀死一个玩家
- 死亡的玩家不能发动技能
- 存活的玩家能够发动技能
- 能够杀死多个玩家
- 重复杀死同一个玩家不会改变状态
- 所有玩家死亡后，存活玩家数量为0
- 没有角色的玩家不能发动技能
- 有特殊标记的死亡玩家（hasAbilityEvenDead）能够发动技能

### 综合场景测试

✅ **完整游戏流程测试**

- 初始化 -> 分配角色 -> 杀死玩家 -> 验证状态

## 测试结果示例

```
PASS  ./gameLoop.test.js
  游戏核心逻辑测试
    基本流程测试：游戏能正常开始，所有玩家分配到了角色
      ✓ 应该能够初始化5个玩家的座位
      ✓ 应该能够为所有玩家分配角色
      ✓ 应该能够为15个玩家分配角色
      ✓ 角色数量不匹配应该抛出错误
      ✓ 无效角色ID应该抛出错误
      ✓ 酒鬼角色应该自动标记为醉酒
    规则冲突测试：如果一个玩家被"杀死"了，验证他的状态确实变成了"死亡"，且无法再发动技能
      ✓ 应该能够杀死一个玩家
      ✓ 死亡的玩家不应该能够发动技能
      ✓ 存活的玩家应该能够发动技能
      ✓ 应该能够杀死多个玩家
      ✓ 重复杀死同一个玩家不应该改变状态
      ✓ 所有玩家死亡后，存活玩家数量应该为0
      ✓ 没有角色的玩家不应该能够发动技能
      ✓ 有特殊标记的死亡玩家（hasAbilityEvenDead）应该能够发动技能
    综合场景测试
      ✓ 完整游戏流程：初始化 -> 分配角色 -> 杀死玩家 -> 验证状态

Test Suites: 1 passed, 1 total
Tests:       15 passed, 15 total
```

## 如何添加新测试

1. 在 `app/gameLogic.ts` 中添加新的可测试函数
2. 在 `gameLoop.test.js` 中添加新的测试用例
3. 运行 `npm test` 验证测试通过

## 注意事项

- 测试文件使用 JavaScript (`.js`)，但可以导入 TypeScript 文件 (`.ts`)
- Jest 会自动处理 TypeScript 文件的编译
- 确保所有测试用例都有清晰的描述和断言

